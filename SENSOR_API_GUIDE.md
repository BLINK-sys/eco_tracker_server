# üîå –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ API –¥–ª—è –¥–∞—Ç—á–∏–∫–æ–≤ EcoTracker

## üì° –û—Å–Ω–æ–≤–Ω–æ–π endpoint –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –¥–∞—Ç—á–∏–∫–æ–≤

**URL**: `/api/sensors/location-update`  
**–ú–µ—Ç–æ–¥**: `POST`  
**Content-Type**: `application/json`

### üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–≠—Ç–æ—Ç endpoint –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –æ—Ç —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞—Ç—á–∏–∫–æ–≤ IoT. –î–∞—Ç—á–∏–∫–∏ –¥–æ–ª–∂–Ω—ã –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ –ø–ª–æ—â–∞–¥–∫–∞–º —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –Ω–∞ —ç—Ç–æ–π –ø–ª–æ—â–∞–¥–∫–µ.

---

## üìã –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è:
- `location_id` (string) - UUID –ø–ª–æ—â–∞–¥–∫–∏
- `containers` (array) - –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ —Å –¥–∞–Ω–Ω—ã–º–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞–∂–¥–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:
- `container_id` (string) - UUID –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞  
- `fill_level` (integer) - –ø—Ä–æ—Ü–µ–Ω—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Ç 0 –¥–æ 100

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–ª—è:
- `timestamp` (string) - –≤—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ ISO 8601

---

## üí° –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞

### –ë–∞–∑–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å —Å –æ–¥–Ω–∏–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º:
```bash
curl -X POST http://your-server.com/api/sensors/location-update \
  -H "Content-Type: application/json" \
  -d '{
    "location_id": "123e4567-e89b-12d3-a456-426614174000",
    "containers": [
      {
        "container_id": "550e8400-e29b-41d4-a716-446655440001",
        "fill_level": 85
      }
    ]
  }'
```

### –ó–∞–ø—Ä–æ—Å —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏:
```bash
curl -X POST http://your-server.com/api/sensors/location-update \
  -H "Content-Type: application/json" \
  -d '{
    "location_id": "123e4567-e89b-12d3-a456-426614174000",
    "containers": [
      {
        "container_id": "550e8400-e29b-41d4-a716-446655440001",
        "fill_level": 85
      },
      {
        "container_id": "550e8400-e29b-41d4-a716-446655440002", 
        "fill_level": 45
      },
      {
        "container_id": "550e8400-e29b-41d4-a716-446655440003",
        "fill_level": 0
      }
    ],
    "timestamp": "2024-01-01T12:00:00Z"
  }'
```

---

## ‚úÖ –ü—Ä–∏–º–µ—Ä —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞

**HTTP Status**: `200 OK`

```json
{
  "message": "–î–∞–Ω–Ω—ã–µ –¥–∞—Ç—á–∏–∫–æ–≤ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã",
  "location": {
    "id": "123e4567-e89b-12d3-a456-426614174000",
    "name": "–ü–ª–æ—â–∞–¥–∫–∞ ‚Ññ1",
    "status": "partial",
    "company_id": "company-uuid-here"
  },
  "updated_containers": [
    {
      "container_id": "550e8400-e29b-41d4-a716-446655440001",
      "fill_level": 85,
      "status": "full"
    },
    {
      "container_id": "550e8400-e29b-41d4-a716-446655440002",
      "fill_level": 45, 
      "status": "partial"
    },
    {
      "container_id": "550e8400-e29b-41d4-a716-446655440003",
      "fill_level": 0,
      "status": "empty"
    }
  ],
  "total_updated": 3
}
```

---

## ‚ùå –ü—Ä–∏–º–µ—Ä—ã –æ—à–∏–±–æ–∫

### –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö:
**HTTP Status**: `400 Bad Request`
```json
{
  "error": "fill_level –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 0 –¥–æ 100, –ø–æ–ª—É—á–µ–Ω: 150"
}
```

### –ü–ª–æ—â–∞–¥–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞:
**HTTP Status**: `400 Bad Request`
```json
{
  "error": "–ü–ª–æ—â–∞–¥–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
}
```

### –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø–ª–æ—â–∞–¥–∫–µ:
**HTTP Status**: `200 OK` (—Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è–º–∏)
```json
{
  "message": "–î–∞–Ω–Ω—ã–µ –¥–∞—Ç—á–∏–∫–æ–≤ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã",
  "location": {...},
  "updated_containers": [...],
  "total_updated": 2,
  "warnings": [
    "–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä 550e8400-xxxx-yyyy –Ω–µ –Ω–∞–π–¥–µ–Ω –Ω–∞ –ø–ª–æ—â–∞–¥–∫–µ 123e4567-abcd-efgh"
  ]
}
```

---

## üîç –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å location_id –∏ container_id?

### –ß–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:
1. –ó–∞–π–¥–∏—Ç–µ –≤ –ø–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ EcoTracker
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "–ü–ª–æ—â–∞–¥–∫–∏"
3. –í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—É—é –ø–ª–æ—â–∞–¥–∫—É - ID –±—É–¥–µ—Ç –≤ URL –∏–ª–∏ –≤ –¥–µ—Ç–∞–ª—è—Ö
4. –í –¥–µ—Ç–∞–ª—è—Ö –ø–ª–æ—â–∞–¥–∫–∏ —É–≤–∏–¥–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ —Å –∏—Ö ID

### –ß–µ—Ä–µ–∑ API:
```bash
# –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –ø–ª–æ—â–∞–¥–∫–∏ –∫–æ–º–ø–∞–Ω–∏–∏
GET /api/locations

# –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –ø–ª–æ—â–∞–¥–∫–∏  
GET /api/locations/{location_id}/containers
```

---

## üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è —Å–∏—Å—Ç–µ–º—ã

–ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

1. **–û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤**:
   - `0-20%` = `empty` (–ø—É—Å—Ç–æ–π)
   - `21-80%` = `partial` (—á–∞—Å—Ç–∏—á–Ω–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–π)
   - `81-100%` = `full` (–ø–æ–ª–Ω—ã–π)

2. **–ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –ø–ª–æ—â–∞–¥–∫–∏**:
   - –ï—Å–ª–∏ –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ø–æ–ª–Ω—ã–µ = `full`
   - –ï—Å–ª–∏ –≤—Å–µ –ø—É—Å—Ç—ã–µ = `empty`  
   - –ò–Ω–∞—á–µ = `partial`

3. **–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**:
   - **WebSocket** - –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–ª—è –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
   - **FCM Push** - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –º–æ–±–∏–ª—å–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–æ—â–∞–¥–∫–∏ –Ω–∞ "full")

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª**: –∫–∞–∂–¥—ã–µ 5-10 –º–∏–Ω—É—Ç  
**–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —á–∞—Å—Ç–æ—Ç–∞**: –Ω–µ —á–∞—â–µ 1 —Ä–∞–∑–∞ –≤ –º–∏–Ω—É—Ç—É  

### –ü—Ä–∏–º–µ—Ä Python —Å–∫—Ä–∏–ø—Ç–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏:
```python
import requests
import time
import json

def send_sensor_data(server_url, location_id, containers_data):
    url = f"{server_url}/api/sensors/location-update"
    
    payload = {
        "location_id": location_id,
        "containers": containers_data,
        "timestamp": time.strftime('%Y-%m-%dT%H:%M:%SZ', time.gmtime())
    }
    
    try:
        response = requests.post(url, json=payload, timeout=30)
        if response.status_code == 200:
            print("‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã")
            return response.json()
        else:
            print(f"‚ùå –û—à–∏–±–∫–∞: {response.status_code} - {response.text}")
            return None
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: {e}")
        return None

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
if __name__ == "__main__":
    SERVER_URL = "http://your-ecotracker-server.com"
    LOCATION_ID = "123e4567-e89b-12d3-a456-426614174000"
    
    # –î–∞–Ω–Ω—ã–µ —Å –¥–∞—Ç—á–∏–∫–æ–≤ (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ)
    sensor_data = [
        {"container_id": "550e8400-e29b-41d4-a716-446655440001", "fill_level": 85},
        {"container_id": "550e8400-e29b-41d4-a716-446655440002", "fill_level": 45}
    ]
    
    result = send_sensor_data(SERVER_URL, LOCATION_ID, sensor_data)
    if result:
        print(f"–û–±–Ω–æ–≤–ª–µ–Ω–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤: {result['total_updated']}")
```

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

–í –±—É–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å:
- API –∫–ª—é—á–∏ –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–∞—Ç—á–∏–∫–æ–≤
- Rate limiting –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —Å–ø–∞–º–∞
- –ü–æ–¥–ø–∏—Å—å –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç JSON –∑–∞–ø—Ä–æ—Å–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ `location_id` –∏ `container_id` —Å—É—â–µ—Å—Ç–≤—É—é—Ç –≤ —Å–∏—Å—Ç–µ–º–µ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏—è `fill_level` –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ 0-100
4. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É —Å–∏—Å—Ç–µ–º—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö ID
